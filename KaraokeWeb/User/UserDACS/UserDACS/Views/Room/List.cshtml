@model IEnumerable<UserDACS.Models.Room>
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor

@{
    ViewData["Title"] = "Danh sách phòng";
}

@if (TempData["Message"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["Message"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<h2 class="mb-4">Danh sách phòng loại @HttpContextAccessor.HttpContext.Request.Query["type"]</h2>

<div class="row g-4">
    @foreach (var room in Model)
    {
        bool isBooked = room.TinhTrang == true;  // giả sử TinhTrang là bool?

        <div class="col-md-4" data-aos="zoom-in">
            <div class="card room-card">
                <img src="@room.ImageUrl" class="card-img-top" alt="@room.TenPhong" style="height:200px; object-fit:cover;" />
                <div class="card-body">
                    <h5 class="card-title">@room.TenPhong</h5>
                    <p class="card-text">Giá: @String.Format("{0:N0}", room.Gia)đ/giờ</p>
                    <p class="card-text">Sức chứa: @room.SucChua người</p>

                    @if (isBooked)
                    {
                        <button type="button" class="btn btn-secondary" disabled>Đã đặt</button>
                    }
                    else
                    {
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#bookingModal" onclick="setRoomName('@room.TenPhong')">Đặt phòng</button>
                    }
                </div>
            </div>
        </div>
    }
</div>

<div class="modal fade" id="bookingModal" tabindex="-1" aria-labelledby="bookingModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content bg-dark text-white">
            <div class="modal-header">
                <h5 class="modal-title text-center w-100 border border-light rounded py-2" id="bookingModalLabel">
                    Đặt Phòng Karaoke
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="post" action="/Booking/SubmitBooking">
                    <div class="mb-3">
                        <label for="fullname" class="form-label">Họ tên</label>
                        <input type="text" name="FullName" class="form-control" id="fullname" required>
                    </div>
                    <div class="mb-3">
                        <label for="phone" class="form-label">Số điện thoại</label>
                        <input type="tel" name="Phone" class="form-control" id="phone" required>
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="text" name="Email" class="form-control" id="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="datetime" class="form-label">Thời gian đặt</label>
                        <input type="datetime-local" name="BookingTime" class="form-control" id="datetime" required>
                    </div>
                    <div class="mb-3">
                        <label for="room" class="form-label">Phòng</label>
                        <input type="text" name="RoomName" class="form-control" id="room" readonly>
                    </div>
                    <div class="text-center mt-3">
                        <button type="submit" class="btn btn-warning px-4">Xác nhận đặt phòng</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init({
            duration: 1000,
            once: true
        });

        function setRoomName(roomName) {
            document.getElementById('room').value = roomName;
        }
    </script>
}
